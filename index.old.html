<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayubo Cafe - Billing System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createClient } = supabase;

        const SUPABASE_URL = 'https://vvemwvrjkxzqtzdcxajn.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2ZW13dnJqa3h6cXR6ZGN4YWpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwMTY1NTgsImV4cCI6MjA3NTU5MjU1OH0.EgMHtI-Gl5Nq-0YlWDZEpx8Z5opLFIk_fhGn9STHkhM';
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const Search = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const Trash2 = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const ShoppingCart = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
        );

        const Settings = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 6l4.2 4.2M23 12h-6m-6 0H1m18.2-5.2l-4.2 4.2m0 6l4.2 4.2"></path>
            </svg>
        );

        const TrendingUp = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const X = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const LogOut = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );

        const User = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const Weight = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
            </svg>
        );

        const Loader = () => (
            <svg className="animate-spin h-5 w-5" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        );

        const AyuboCafe = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [loginRole, setLoginRole] = useState('');
            const [password, setPassword] = useState('');
            const [products, setProducts] = useState([]);
            const [cart, setCart] = useState([]);
            const [bills, setBills] = useState([]);
            const [showSettings, setShowSettings] = useState(false);
            const [showSales, setShowSales] = useState(false);
            const [newProduct, setNewProduct] = useState({ name: '', price: '', isWeightBased: false });
            const [editingProduct, setEditingProduct] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [showBillPreview, setShowBillPreview] = useState(false);
            const [showWeightModal, setShowWeightModal] = useState(false);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [weight, setWeight] = useState('');
            const [customerPaid, setCustomerPaid] = useState('');
            const [loading, setLoading] = useState(true);

            const users = {
                owner: { password: 'Sokian@1997', role: 'owner' },
                cashier: { password: 'cashier123', role: 'cashier' }
            };

            useEffect(() => {
                loadProducts();
                loadBills();
            }, []);

            const loadProducts = async () => {
                try {
                    const { data, error } = await supabaseClient
                        .from('products')
                        .select('*')
                        .order('id', { ascending: true });

                    if (error) throw error;

                    if (data && data.length > 0) {
                        setProducts(data);
                    } else {
                        await initializeDefaultProducts();
                    }
                } catch (error) {
                    console.error('Error loading products:', error);
                    alert('Error loading products. Please refresh the page.');
                } finally {
                    setLoading(false);
                }
            };

            const initializeDefaultProducts = async () => {
                const defaultProducts = [
                    { id: 1, name: 'Egg Pastry', price: 110, is_weight_based: false },
                    { id: 2, name: 'Fish Pastry', price: 90, is_weight_based: false },
                    { id: 3, name: 'Egg Roll', price: 100, is_weight_based: false },
                    { id: 4, name: 'Fish Roll', price: 80, is_weight_based: false },
                    { id: 5, name: 'Egg Bun', price: 60, is_weight_based: false },
                    { id: 6, name: 'Fish Bun', price: 70, is_weight_based: false },
                    { id: 7, name: 'Meatball bun', price: 120, is_weight_based: false },
                    { id: 8, name: 'Finger Bun', price: 120, is_weight_based: false },
                    { id: 9, name: 'Omlet Bun', price: 80, is_weight_based: false },
                    { id: 10, name: 'Patis', price: 55, is_weight_based: false },
                    { id: 11, name: 'Egg Sandwich', price: 100, is_weight_based: false },
                    { id: 12, name: 'Gateau Piece', price: 120, is_weight_based: false },
                    { id: 13, name: 'Cashew Bar', price: 150, is_weight_based: false },
                    { id: 14, name: 'Chocolate icing cake (1kg)', price: 1750, is_weight_based: false },
                    { id: 15, name: 'Chocolate icing cake (small)', price: 1200, is_weight_based: false },
                    { id: 16, name: 'Vanila icing cake (1kg)', price: 1600, is_weight_based: false },
                    { id: 17, name: 'Vanila icing cake (small)', price: 1100, is_weight_based: false },
                    { id: 18, name: 'Tea Bun', price: 50, is_weight_based: false },
                    { id: 19, name: 'Cream Bun', price: 60, is_weight_based: false },
                    { id: 20, name: 'Kothmale Chocolate', price: 100, is_weight_based: false },
                    { id: 21, name: 'Plane Tea(Ginger)', price: 50, is_weight_based: false },
                    { id: 22, name: 'Plane Tea (Normal)', price: 40, is_weight_based: false },
                    { id: 23, name: 'Tea', price: 100, is_weight_based: false },
                    { id: 24, name: 'Chai Tea', price: 140, is_weight_based: false },
                    { id: 25, name: 'Cordial', price: 100, is_weight_based: false },
                    { id: 26, name: 'Faluda', price: 200, is_weight_based: false },
                    { id: 27, name: 'Mini Spunchi', price: 150, is_weight_based: false },
                    { id: 28, name: 'Opera Cake', price: 150, is_weight_based: false },
                    { id: 29, name: 'Cheese Cake', price: 200, is_weight_based: false },
                    { id: 30, name: 'Sandwich Bread', price: 180, is_weight_based: false },
                    { id: 31, name: 'Normal Bread (450g)', price: 120, is_weight_based: false },
                    { id: 32, name: 'Donut', price: 150, is_weight_based: false },
                    { id: 33, name: 'Butter Cake', price: 1000, is_weight_based: true },
                    { id: 34, name: 'Chocolate Cake', price: 1250, is_weight_based: true },
                    { id: 35, name: 'Ribbon Cake', price: 1200, is_weight_based: true }
                ];

                const { error } = await supabaseClient
                    .from('products')
                    .insert(defaultProducts);

                if (error) {
                    console.error('Error initializing products:', error);
                } else {
                    setProducts(defaultProducts);
                }
            };

            const loadBills = async () => {
                try {
                    const { data, error } = await supabaseClient
                        .from('bills')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    setBills(data || []);
                } catch (error) {
                    console.error('Error loading bills:', error);
                }
            };

            const handleLogin = () => {
                if (loginRole === 'guest') {
                    setCurrentUser({ role: 'guest' });
                    return;
                }

                const user = users[loginRole];
                if (user && user.password === password) {
                    setCurrentUser({ role: loginRole });
                    setPassword('');
                } else {
                    alert('Invalid password!');
                }
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setLoginRole('');
                setPassword('');
                setCart([]);
                setShowSettings(false);
                setShowSales(false);
            };

            const addToCart = (product) => {
                if (product.is_weight_based) {
                    setSelectedProduct(product);
                    setShowWeightModal(true);
                    return;
                }

                const existing = cart.find(item => item.id === product.id && !item.weight);
                if (existing) {
                    setCart(cart.map(item =>
                        item.id === product.id && !item.weight ? { ...item, quantity: item.quantity + 1 } : item
                    ));
                } else {
                    setCart([...cart, { ...product, quantity: 1 }]);
                }
            };

            const addWeightBasedProduct = () => {
                const weightValue = parseFloat(weight);
                if (!weightValue || weightValue <= 0) {
                    alert('Please enter a valid weight');
                    return;
                }

                const cartItem = {
                    ...selectedProduct,
                    quantity: weightValue,
                    weight: weightValue,
                    displayName: `${selectedProduct.name} (${weightValue}kg)`
                };

                setCart([...cart, cartItem]);
                setShowWeightModal(false);
                setWeight('');
                setSelectedProduct(null);
            };

            const updateQuantity = (index, quantity) => {
                if (quantity <= 0) {
                    setCart(cart.filter((_, i) => i !== index));
                } else {
                    setCart(cart.map((item, i) =>
                        i === index ? { ...item, quantity: parseFloat(quantity) } : item
                    ));
                }
            };

            const removeFromCart = (index) => {
                setCart(cart.filter((_, i) => i !== index));
            };

            const calculateTotal = () => {
                return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2);
            };

            const calculateBalance = () => {
                const paid = parseFloat(customerPaid) || 0;
                const total = parseFloat(calculateTotal());
                return (paid - total).toFixed(2);
            };

            const generateBill = () => {
                if (cart.length === 0) {
                    alert('Cart is empty!');
                    return;
                }
                setShowBillPreview(true);
            };

            const confirmBill = async () => {
                try {
                    const billDate = new Date().toLocaleString();
                    const totalAmount = parseFloat(calculateTotal());
                    const paidAmount = parseFloat(customerPaid) || 0;
                    const balanceAmount = paidAmount - totalAmount;

                    const billItems = cart.map(item => ({
                        date: billDate,
                        product_id: item.id,
                        product_name: item.displayName || item.name,
                        product_price: item.price,
                        quantity: item.quantity,
                        total: item.price * item.quantity,
                        paid_amount: paidAmount,
                        balance: balanceAmount
                    }));

                    const { error } = await supabaseClient
                        .from('bills')
                        .insert(billItems);

                    if (error) throw error;

                    await loadBills();
                    setCart([]);
                    setCustomerPaid('');
                    setShowBillPreview(false);
                    alert('Bill saved successfully!');
                } catch (error) {
                    console.error('Error saving bill:', error);
                    alert('Error saving bill. Please try again.');
                }
            };

            const addProduct = async () => {
                if (!newProduct.name || !newProduct.price) {
                    alert('Please fill all fields');
                    return;
                }

                try {
                    const product = {
                        id: Date.now(),
                        name: newProduct.name,
                        price: parseFloat(newProduct.price),
                        is_weight_based: newProduct.isWeightBased
                    };

                    const { error } = await supabaseClient
                        .from('products')
                        .insert([product]);

                    if (error) throw error;

                    await loadProducts();
                    setNewProduct({ name: '', price: '', isWeightBased: false });
                    alert('Product added successfully!');
                } catch (error) {
                    console.error('Error adding product:', error);
                    alert('Error adding product. Please try again.');
                }
            };

            const deleteProduct = async (id) => {
                if (!window.confirm('Are you sure you want to delete this product?')) return;

                try {
                    const { error } = await supabaseClient
                        .from('products')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;

                    await loadProducts();
                    alert('Product deleted successfully!');
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('Error deleting product. Please try again.');
                }
            };

            const deleteBill = async (billId) => {
                if (!window.confirm('Are you sure you want to delete this bill?')) return;

                try {
                    const { error} = await supabaseClient
                        .from('bills')
                        .delete()
                        .eq('id', billId);

                    if (error) throw error;

                    await loadBills();
                    alert('Bill deleted successfully!');
                } catch (error) {
                    console.error('Error deleting bill:', error);
                    alert('Error deleting bill. Please try again.');
                }
            };

            const startEdit = (product) => {
                setEditingProduct({ ...product });
            };

            const saveEdit = async () => {
                try {
                    const { error } = await supabaseClient
                        .from('products')
                        .update({
                            name: editingProduct.name,
                            price: editingProduct.price,
                            is_weight_based: editingProduct.is_weight_based
                        })
                        .eq('id', editingProduct.id);

                    if (error) throw error;

                    await loadProducts();
                    setEditingProduct(null);
                    alert('Product updated successfully!');
                } catch (error) {
                    console.error('Error updating product:', error);
                    alert('Error updating product. Please try again.');
                }
            };

            const getDailySales = () => {
                const today = new Date().toLocaleDateString();
                const todayBills = bills.filter(bill =>
                    new Date(bill.date).toLocaleDateString() === today
                );
                
                const uniqueTransactions = {};
                todayBills.forEach(bill => {
                    const key = `${bill.date}-${bill.paid_amount}-${bill.balance}`;
                    if (!uniqueTransactions[key]) {
                        uniqueTransactions[key] = {
                            total: 0,
                            items: []
                        };
                    }
                    uniqueTransactions[key].total += parseFloat(bill.total);
                    uniqueTransactions[key].items.push(bill);
                });

                const total = Object.values(uniqueTransactions).reduce((sum, trans) => sum + trans.total, 0);
                return { count: Object.keys(uniqueTransactions).length, total: total.toFixed(2) };
            };

            const getTotalSales = () => {
                const uniqueTransactions = {};
                bills.forEach(bill => {
                    const key = `${bill.date}-${bill.paid_amount}-${bill.balance}`;
                    if (!uniqueTransactions[key]) {
                        uniqueTransactions[key] = { total: 0 };
                    }
                    uniqueTransactions[key].total += parseFloat(bill.total);
                });

                const total = Object.values(uniqueTransactions).reduce((sum, trans) => sum + trans.total, 0);
                return { count: Object.keys(uniqueTransactions).length, total: total.toFixed(2) };
            };

            const getItemWiseSales = () => {
                const itemSales = {};
                bills.forEach(bill => {
                    if (!itemSales[bill.product_name]) {
                        itemSales[bill.product_name] = { quantity: 0, revenue: 0 };
                    }
                    itemSales[bill.product_name].quantity += parseFloat(bill.quantity);
                    itemSales[bill.product_name].revenue += parseFloat(bill.total);
                });
                return Object.entries(itemSales).map(([name, data]) => ({
                    name,
                    ...data
                })).sort((a, b) => b.revenue - a.revenue);
            };

            const getUniqueBills = () => {
                const uniqueTransactions = {};
                bills.forEach(bill => {
                    const key = `${bill.date}-${bill.paid_amount}-${bill.balance}`;
                    if (!uniqueTransactions[key]) {
                        uniqueTransactions[key] = {
                            id: bill.id,
                            date: bill.date,
                            total: 0,
                            items: []
                        };
                    }
                    uniqueTransactions[key].total += parseFloat(bill.total);
                    uniqueTransactions[key].items.push(bill);
                });
                return Object.values(uniqueTransactions);
            };

            const filteredProducts = products.filter(product =>
                product.name.toLowerCase().includes(searchQuery.toLowerCase())
            );

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-yellow-50 to-green-50 flex items-center justify-center">
                        <div className="text-center">
                            <Loader />
                            <p className="mt-4 text-blue-700 font-semibold">Loading Ayubo Cafe...</p>
                        </div>
                    </div>
                );
            }

            if (!currentUser) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-yellow-50 to-green-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-2xl p-6 sm:p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl sm:text-4xl font-bold text-blue-700 mb-2">Ayubo Cafe</h1>
                                <p className="text-gray-600">Select your role to continue</p>
                            </div>
                            
                            <div className="space-y-4">
                                <button
                                    onClick={() => setLoginRole('guest')}
                                    className={`w-full p-4 rounded-lg border-2 transition ${
                                        loginRole === 'guest'
                                            ? 'border-blue-500 bg-blue-50'
                                            : 'border-gray-300 hover:border-blue-300'
                                    }`}
                                >
                                    <div className="flex items-center gap-3">
                                        <User size={24} />
                                        <div className="text-left">
                                            <div className="font-bold">Guest</div>
                                            <div className="text-sm text-gray-600">Billing only</div>
                                        </div>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setLoginRole('cashier')}
                                    className={`w-full p-4 rounded-lg border-2 transition ${
                                        loginRole === 'cashier'
                                            ? 'border-blue-500 bg-blue-50'
                                            : 'border-gray-300 hover:border-blue-300'
                                    }`}
                                >
                                    <div className="flex items-center gap-3">
                                        <User size={24} />
                                        <div className="text-left">
                                            <div className="font-bold">Cashier</div>
                                            <div className="text-sm text-gray-600">Manage products & billing</div>
                                        </div>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setLoginRole('owner')}
                                    className={`w-full p-4 rounded-lg border-2 transition ${
                                        loginRole === 'owner'
                                            ? 'border-blue-500 bg-blue-50'
                                            : 'border-gray-300 hover:border-blue-300'
                                    }`}
                                >
                                    <div className="flex items-center gap-3">
                                        <User size={24} />
                                        <div className="text-left">
                                            <div className="font-bold">Owner</div>
                                            <div className="text-sm text-gray-600">Full access</div>
                                        </div>
                                    </div>
                                </button>

                                {(loginRole === 'cashier' || loginRole === 'owner') && (
                                    <input
                                        type="password"
                                        placeholder="Enter password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                        className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:border-blue-500"
                                    />
                                )}

                                <button
                                    onClick={handleLogin}
                                    disabled={!loginRole}
                                    className="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:from-blue-700 hover:to-blue-800 transition"
                                >
                                    Login
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (showWeightModal) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-bold text-blue-700">Enter Weight</h2>
                                <button onClick={() => { setShowWeightModal(false); setWeight(''); }} className="text-gray-600 hover:text-gray-800">
                                    <X size={24} />
                                </button>
                            </div>
                            
                            <div className="mb-4">
                                <p className="text-gray-700 mb-2">Product: <span className="font-semibold">{selectedProduct?.name}</span></p>
                                <p className="text-gray-700 mb-4">Price: <span className="font-semibold">Rs. {selectedProduct?.price}/kg</span></p>
                                
                                <label className="block text-sm font-semibold mb-2">Weight (kg):</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={weight}
                                    onChange={(e) => setWeight(e.target.value)}
                                    placeholder="Enter weight in kg"
                                    className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                    autoFocus
                                    onKeyPress={(e) => e.key === 'Enter' && addWeightBasedProduct()}
                                />
                                
                                {weight && (
                                    <div className="mt-3 p-3 bg-green-50 border-2 border-green-300 rounded-lg">
                                        <p className="text-sm text-gray-600">Total Price:</p>
                                        <p className="text-xl font-bold text-green-700">
                                            Rs. {(parseFloat(weight) * selectedProduct?.price).toFixed(2)}
                                        </p>
                                    </div>
                                )}
                            </div>
                            
                            <button
                                onClick={addWeightBasedProduct}
                                className="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-blue-800 transition"
                            >
                                Add to Cart
                            </button>
                        </div>
                    </div>
                );
            }

            if (showBillPreview) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-yellow-50 to-green-50 p-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl sm:text-2xl font-bold text-blue-700">Bill Preview</h2>
                                    <button onClick={() => setShowBillPreview(false)} className="text-gray-600 hover:text-gray-800">
                                        <X size={24} />
                                    </button>
                                </div>

                                <div className="border-2 border-blue-200 rounded-lg p-4 mb-4">
                                    <h3 className="text-center text-2xl font-bold text-blue-700 mb-1">Ayubo Cafe</h3>
                                    <p className="text-center text-sm text-gray-600 mb-4">{new Date().toLocaleString()}</p>
                                    
                                    <div className="border-t border-b border-gray-300 py-2 mb-2">
                                        <div className="grid grid-cols-12 gap-2 font-semibold text-sm">
                                            <div className="col-span-5">Item</div>
                                            <div className="col-span-2 text-center">Qty</div>
                                            <div className="col-span-2 text-right">Price</div>
                                            <div className="col-span-3 text-right">Total</div>
                                        </div>
                                    </div>

                                    {cart.map((item, index) => (
                                        <div key={index} className="grid grid-cols-12 gap-2 py-1 text-sm">
                                            <div className="col-span-5">{item.displayName || item.name}</div>
                                            <div className="col-span-2 text-center">{item.quantity}{item.is_weight_based ? 'kg' : ''}</div>
                                            <div className="col-span-2 text-right">{item.price.toFixed(2)}</div>
                                            <div className="col-span-3 text-right font-semibold">{(item.price * item.quantity).toFixed(2)}</div>
                                        </div>
                                    ))}

                                    <div className="border-t-2 border-gray-300 mt-2 pt-2">
                                        <div className="flex justify-between text-lg font-bold mb-2">
                                            <span>Total:</span>
                                            <span className="text-blue-700">Rs. {calculateTotal()}</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-sm font-semibold mb-1">Customer Paid:</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={customerPaid}
                                            onChange={(e) => setCustomerPaid(e.target.value)}
                                            placeholder="Enter amount"
                                            className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                    </div>

                                    {customerPaid && (
                                        <div className="bg-green-50 border-2 border-green-300 rounded-lg p-3">
                                            <div className="flex justify-between text-lg font-bold">
                                                <span>Balance:</span>
                                                <span className={parseFloat(calculateBalance()) >= 0 ? 'text-green-700' : 'text-red-700'}>
                                                    Rs. {calculateBalance()}
                                                </span>
                                            </div>
                                        </div>
                                    )}

                                    <button
                                        onClick={confirmBill}
                                        className="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-bold hover:from-green-700 hover:to-green-800 transition"
                                    >
                                        Confirm & Save Bill
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-yellow-50 to-green-50 p-2 sm:p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
                            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                                <div>
                                    <h1 className="text-2xl sm:text-3xl font-bold text-blue-700">Ayubo Cafe</h1>
                                    <p className="text-sm text-gray-600">Logged in as: <span className="font-semibold capitalize">{currentUser.role}</span></p>
                                </div>
                                <div className="flex flex-wrap gap-2">
                                    {currentUser.role === 'owner' && (
                                        <button
                                            onClick={() => setShowSales(!showSales)}
                                            className="flex items-center gap-2 bg-green-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-green-700 transition text-sm"
                                        >
                                            <TrendingUp size={18} />
                                            <span className="hidden sm:inline">Sales</span>
                                        </button>
                                    )}
                                    {(currentUser.role === 'cashier' || currentUser.role === 'owner') && (
                                        <button
                                            onClick={() => setShowSettings(!showSettings)}
                                            className="flex items-center gap-2 bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm"
                                        >
                                            <Settings size={18} />
                                            <span className="hidden sm:inline">Products</span>
                                        </button>
                                    )}
                                    <button
                                        onClick={handleLogout}
                                        className="flex items-center gap-2 bg-red-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-red-700 transition text-sm"
                                    >
                                        <LogOut size={18} />
                                        <span className="hidden sm:inline">Logout</span>
                                    </button>
                                </div>
                            </div>

                            {showSettings && (
                                <div className="mb-6 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-lg sm:text-xl font-bold text-blue-800">Manage Products</h2>
                                        <button onClick={() => setShowSettings(false)} className="text-blue-800 hover:text-blue-900">
                                            <X size={24} />
                                        </button>
                                    </div>
                                    <div className="space-y-2 mb-4">
                                        <div className="flex flex-col sm:flex-row gap-2">
                                            <input
                                                type="text"
                                                placeholder="Product Name"
                                                value={newProduct.name}
                                                onChange={(e) => setNewProduct({ ...newProduct, name: e.target.value })}
                                                className="flex-1 px-3 py-2 border-2 border-blue-300 rounded-lg focus:outline-none focus:border-blue-500 text-sm"
                                            />
                                            <input
                                                type="number"
                                                step="0.01"
                                                placeholder="Price"
                                                value={newProduct.price}
                                                onChange={(e) => setNewProduct({ ...newProduct, price: e.target.value })}
                                                className="w-full sm:w-32 px-3 py-2 border-2 border-blue-300 rounded-lg focus:outline-none focus:border-blue-500 text-sm"
                                            />
                                            <button
                                                onClick={addProduct}
                                                className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm"
                                            >
                                                Add
                                            </button>
                                        </div>
                                        <label className="flex items-center gap-2 text-sm">
                                            <input
                                                type="checkbox"
                                                checked={newProduct.isWeightBased}
                                                onChange={(e) => setNewProduct({ ...newProduct, isWeightBased: e.target.checked })}
                                                className="w-4 h-4"
                                            />
                                            <span>Weight-based pricing (price per kg)</span>
                                        </label>
                                    </div>
                                    <div className="space-y-2 max-h-64 overflow-y-auto">
                                        {products.map(product => (
                                            <div key={product.id} className="flex flex-col sm:flex-row items-start sm:items-center gap-2 p-2 bg-white rounded border border-blue-200 text-sm">
                                                {editingProduct?.id === product.id ? (
                                                    <>
                                                        <input
                                                            type="text"
                                                            value={editingProduct.name}
                                                            onChange={(e) => setEditingProduct({ ...editingProduct, name: e.target.value })}
                                                            className="flex-1 w-full px-2 py-1 border-2 border-blue-300 rounded focus:outline-none focus:border-blue-500"
                                                        />
                                                        <input
                                                            type="number"
                                                            step="0.01"
                                                            value={editingProduct.price}
                                                            onChange={(e) => setEditingProduct({ ...editingProduct, price: parseFloat(e.target.value) })}
                                                            className="w-full sm:w-24 px-2 py-1 border-2 border-blue-300 rounded focus:outline-none focus:border-blue-500"
                                                        />
                                                        <label className="flex items-center gap-1 text-xs">
                                                            <input
                                                                type="checkbox"
                                                                checked={editingProduct.is_weight_based}
                                                                onChange={(e) => setEditingProduct({ ...editingProduct, is_weight_based: e.target.checked })}
                                                                className="w-3 h-3"
                                                            />
                                                            <span>Weight</span>
                                                        </label>
                                                        <div className="flex gap-2 w-full sm:w-auto">
                                                            <button onClick={saveEdit} className="flex-1 sm:flex-none bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">
                                                                Save
                                                            </button>
                                                            <button onClick={() => setEditingProduct(null)} className="flex-1 sm:flex-none bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600">
                                                                Cancel
                                                            </button>
                                                        </div>
                                                    </>
                                                ) : (
                                                    <>
                                                        <span className="flex-1 flex items-center gap-1">
                                                            {product.name}
                                                            {product.is_weight_based && <Weight size={14} className="text-orange-600" />}
                                                        </span>
                                                        <span className="w-24 font-semibold text-blue-700">
                                                            Rs. {product.price.toFixed(2)}{product.is_weight_based && '/kg'}
                                                        </span>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => startEdit(product)} className="text-blue-600 px-2 hover:text-blue-800">
                                                                Edit
                                                            </button>
                                                            <button onClick={() => deleteProduct(product.id)} className="text-red-600 hover:text-red-800">
                                                                <Trash2 size={18} />
                                                            </button>
                                                        </div>
                                                    </>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {showSales && (
                                <div className="mb-6 p-4 bg-green-50 rounded-lg border-2 border-green-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-lg sm:text-xl font-bold text-green-800">Sales Reports</h2>
                                        <button onClick={() => setShowSales(false)} className="text-green-800 hover:text-green-900">
                                            <X size={24} />
                                        </button>
                                    </div>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                                        <div className="bg-white p-4 rounded-lg border-2 border-green-200">
                                            <h3 className="text-sm text-gray-600 mb-1">Today's Sales</h3>
                                            <p className="text-xl sm:text-2xl font-bold text-green-700">Rs. {getDailySales().total}</p>
                                            <p className="text-sm text-gray-500">{getDailySales().count} bills</p>
                                        </div>
                                        <div className="bg-white p-4 rounded-lg border-2 border-blue-200">
                                            <h3 className="text-sm text-gray-600 mb-1">Total Sales</h3>
                                            <p className="text-xl sm:text-2xl font-bold text-blue-700">Rs. {getTotalSales().total}</p>
                                            <p className="text-sm text-gray-500">{getTotalSales().count} bills</p>
                                        </div>
                                    </div>

                                    <div className="mb-4">
                                        <h3 className="font-bold text-green-800 mb-2">Item-wise Sales</h3>
                                        <div className="bg-white rounded-lg border-2 border-green-200 max-h-48 overflow-y-auto">
                                            <table className="w-full text-sm">
                                                <thead className="bg-green-100 sticky top-0">
                                                    <tr>
                                                        <th className="text-left p-2">Item</th>
                                                        <th className="text-center p-2">Qty</th>
                                                        <th className="text-right p-2">Revenue</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {getItemWiseSales().map((item, idx) => (
                                                        <tr key={idx} className="border-t border-green-100">
                                                            <td className="p-2">{item.name}</td>
                                                            <td className="text-center p-2">{item.quantity.toFixed(2)}</td>
                                                            <td className="text-right p-2 font-semibold">Rs. {item.revenue.toFixed(2)}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className="font-bold text-green-800 mb-2">Recent Bills</h3>
                                        <div className="max-h-64 overflow-y-auto space-y-2">
                                            {getUniqueBills().map(bill => (
                                                <div key={bill.id} className="bg-white p-3 rounded border border-green-200">
                                                    <div className="flex justify-between items-start mb-1">
                                                        <span className="text-xs text-gray-600">{bill.date}</span>
                                                        <div className="flex items-center gap-2">
                                                            <span className="font-bold text-green-700">Rs. {bill.total.toFixed(2)}</span>
                                                            <button
                                                                onClick={() => deleteBill(bill.id)}
                                                                className="text-red-600 hover:text-red-800"
                                                            >
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="text-xs text-gray-500">
                                                        {bill.items.map((item, idx) => `${item.product_name} x${item.quantity}`).join(', ')}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                                <div>
                                    <h2 className="text-lg sm:text-xl font-bold mb-4 text-blue-700">Products</h2>
                                    <div className="mb-4 relative">
                                        <Search size={20} className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
                                        <input
                                            type="text"
                                            placeholder="Search products..."
                                            value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                            className="w-full pl-10 pr-4 py-2 border-2 border-blue-300 rounded-lg focus:outline-none focus:border-blue-500 text-sm"
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 xl:grid-cols-3 gap-2 sm:gap-3 max-h-96 overflow-y-auto">
                                        {filteredProducts.length > 0 ? (
                                            filteredProducts.map(product => (
                                                <button
                                                    key={product.id}
                                                    onClick={() => addToCart(product)}
                                                    className="bg-gradient-to-br from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-gray-900 p-3 sm:p-4 rounded-lg text-left transition shadow-md hover:shadow-lg relative"
                                                >
                                                    {product.is_weight_based && (
                                                        <div className="absolute top-1 right-1">
                                                            <Weight size={16} className="text-orange-700" />
                                                        </div>
                                                    )}
                                                    <div className="font-semibold text-sm sm:text-base line-clamp-2">{product.name}</div>
                                                    <div className="text-xs sm:text-sm font-bold mt-1">
                                                        Rs. {product.price.toFixed(2)}{product.is_weight_based && '/kg'}
                                                    </div>
                                                </button>
                                            ))
                                        ) : (
                                            <div className="col-span-2 sm:col-span-3 lg:col-span-2 xl:col-span-3 text-center text-gray-500 py-8">
                                                No products found
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div>
                                    <h2 className="text-lg sm:text-xl font-bold mb-4 text-blue-700 flex items-center gap-2">
                                        <ShoppingCart size={24} />
                                        Cart
                                    </h2>
                                    <div className="bg-blue-50 rounded-lg p-3 sm:p-4 border-2 border-blue-200">
                                        {cart.length === 0 ? (
                                            <p className="text-gray-500 text-center py-8">Cart is empty</p>
                                        ) : (
                                            <>
                                                <div className="space-y-2 mb-4 max-h-64 overflow-y-auto">
                                                    {cart.map((item, index) => (
                                                        <div key={index} className="flex flex-col sm:flex-row items-start sm:items-center gap-2 bg-white p-2 sm:p-3 rounded border border-blue-200">
                                                            <div className="flex-1 w-full">
                                                                <div className="font-semibold text-blue-900 text-sm">{item.displayName || item.name}</div>
                                                                <div className="text-xs text-gray-600">Rs. {item.price.toFixed(2)} {item.is_weight_based ? 'per kg' : 'each'}</div>
                                                            </div>
                                                            <div className="flex items-center gap-2 w-full sm:w-auto">
                                                                {!item.is_weight_based && (
                                                                    <input
                                                                        type="number"
                                                                        min="1"
                                                                        value={item.quantity}
                                                                        onChange={(e) => updateQuantity(index, e.target.value)}
                                                                        className="w-16 px-2 py-1 border-2 border-blue-300 rounded text-center focus:outline-none focus:border-blue-500 text-sm"
                                                                    />
                                                                )}
                                                                {item.is_weight_based && (
                                                                    <span className="text-sm font-semibold">{item.quantity}kg</span>
                                                                )}
                                                                <div className="flex-1 sm:w-20 text-right font-semibold text-blue-700 text-sm">
                                                                    Rs. {(item.price * item.quantity).toFixed(2)}
                                                                </div>
                                                                <button
                                                                    onClick={() => removeFromCart(index)}
                                                                    className="text-red-600 hover:text-red-800"
                                                                >
                                                                    <Trash2 size={18} />
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="border-t-2 border-blue-300 pt-4">
                                                    <div className="flex justify-between items-center mb-4">
                                                        <span className="text-lg sm:text-xl font-bold text-blue-900">Total:</span>
                                                        <span className="text-xl sm:text-2xl font-bold text-green-700">Rs. {calculateTotal()}</span>
                                                    </div>
                                                    <button
                                                        onClick={generateBill}
                                                        className="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white py-3 rounded-lg font-bold transition shadow-md hover:shadow-lg"
                                                    >
                                                        Generate Bill
                                                    </button>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AyuboCafe />);
    </script>
</body>
</html>